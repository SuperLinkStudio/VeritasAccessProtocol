# VeritasAccessProtocol (VAP) 规范文档

## 协议概述

VeritasAccessProtocol (VAP) 是一种**专门用于管理访问令牌使用阶段**的安全协议，旨在保障客户端与服务端之间受保护数据的交互安全。

## 术语表

### 角色

| 角色       | 解释                                                                                            |
| ---------- | ----------------------------------------------------------------------------------------------- |
| 用户       | 使用客户端并作为其个人数据所有者的一方                                                          |
| 客户端     | 依据 VAP 协议向资源服务器请求访问用户数据的一方                                                 |
| 认证服务器 | 负责用户身份认证、向客户端颁发 `access_token`、并向资源服务器提供 `access_token` 验证服务的一方 |
| 资源服务器 | 存储并提供用户数据的一方或多方                                                                  |
| 服务端     | 认证服务器与资源服务器的统称                                                                    |

> [!TIP]
> 有时资源服务器与认证服务器是同一个主体。

## 加密与密钥

VAP 中一切需要加密传输的信息均采用 `RSA-3072` 算法。服务（指客户端与资源服务器）在部署前，其开发者必须向认证服务器完成服务注册，以获取相应的密钥。

产品与认证服务器之间，需约定并部署两组密钥对，分别称为 `A` (包含 `private_A` 和 `public_A`) 和 密钥对 `B` (包含 `private_B` 和 `public_B`) 表示。这两组密钥对构成一个**密钥组**。

假设**发送方**持有密钥 `private_A` 和 `public_B`，**接收方**持有密钥对 `private_B` 和 `public_A`，数据 `data` 的加密传输流程如下:

**发送方**操作:

1. 使用 `private_A` 对 `data` 进行签名，生成 `signature_data`
2. 使用 `public_B` 对 `data` 进行加密，生成 `data_ciphertext`
3. 依据 VAP 相关流程，以规定的形式发送 `signature_data` 和 `data_ciphertext`

**接收方**操作:

1. 依据 VAP 相关流程，以规定的形式接收 `signature_data` 和 `data_ciphertext`
2. 使用 `private_B` 对 `data_ciphertext` 进行解密，得到原始 `data`
3. 使用 `public_A` 和 `data` 对 `signature_data` 进行验签

### 关键配置原则

VAP 协议中仅配置两个密钥组：

1. 客户端与认证服务器之间部署一个密钥组。

2. 资源服务器与认证服务器之间部署一个密钥组。

协议**禁止在客户端与资源服务器之间**配置或共享密钥组。
